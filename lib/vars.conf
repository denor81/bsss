# ВНИМАНИЕ: Все относительные пути задаются БЕЗ завершающего и начального слеша
# Например: "utils", "modules", но не "/utils" или "utils/"

readonly CURRENT_MODULE_NAME="$(basename "$0")"
readonly UTIL_NAME="bsss"

readonly I18N_DIR="${PROJECT_ROOT}/lib/i18n"
readonly LANG_FILE="${PROJECT_ROOT}/.lang"
declare -gA I18N_MESSAGES=() # Массив переводов
source "${PROJECT_ROOT}/lib/i18n/critical/common.sh" # Критические сообщения

readonly UTILS_DIR="utils"
readonly MODULES_DIR="modules"
readonly MODULES_MASK='*.sh' # nullglob mask
readonly MODULE_TYPE_MODIFY="modify"
readonly MODULE_TYPE_CHECK="check"

readonly UNINSTALL_PATHS=".uninstall_paths"

readonly OS_RELEASE_FILE_PATH="/etc/os-release"
readonly ALLOWED_SYS="ubuntu"

readonly REBOOT_REQUIRED_FILE_PATH="/var/run/reboot-required"

readonly DEFAULT_SSH_PORT=22
readonly SSH_CONFIG_FILE="/etc/ssh/sshd_config"
readonly SSH_CONFIG_DIR="/etc/ssh"
readonly SSH_CONFIGD_DIR="/etc/ssh/sshd_config.d"
readonly BSSS_SSH_CONFIG_FILE_NAME="40-bsss-ssh-port.conf"
readonly BSSS_PERMISSIONS_CONFIG_FILE_NAME="-bsss-permissions.conf"
readonly BSSS_SSH_CONFIG_FILE_MASK='*bsss-ssh-port.conf' # nullglob mask
readonly SSH_CONFIG_FILE_MASK='*.conf' # nullglob mask
readonly BSSS_MARKER_COMMENT="Generated by ${UTIL_NAME^^}"
readonly ROLLBACK_MODULE_NAME="rollback.sh"
readonly ROLLBACK_TIMER_SECONDS=4
readonly SSH_PORT_CHECK_TIMEOUT=2

readonly UFW_BEFORE_RULES="/etc/ufw/before.rules"
readonly UFW_BEFORE_RULES_BACKUP="/etc/ufw/before.rules.bsss_backup"

readonly SUDOERS_D_DIR="/etc/sudoers.d"
readonly BSSS_USER_NAME="bsssuser"
readonly BSSS_USER_PASS_LEN=10

readonly WATCHDOG_FIFO="${PROJECT_ROOT}/bsss_watchdog_$$.fifo"
WATCHDOG_PID=""

# По умолчанию логгер работает в строгом режиме (для родителя) и не маскирует ошики
LOG_STRICT_MODE=true # false включается в rollback.sh для маскировки ошибок при закрытом дескриторе FIFO
readonly LOGS_DIR="logs"
readonly MAX_LOG_FILES=10
readonly CURRENT_LOG_SYMLINK="${PROJECT_ROOT}/${LOGS_DIR}/current.log" # symlink to current log
